<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Network Guardian | ARP-Scan Deep Dive</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .feature-card { border-left: 5px solid #0d6efd; transition: 0.3s; }
        .feature-card:hover { transform: translateY(-5px); }
        .logic-box { background: #f8f9fa; border-radius: 8px; padding: 15px; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4">üõ°Ô∏è Network Guardian Dashboard</h1>
        <p class="lead">Analyzing local network security using the <strong>ARP-Scan</strong> utility.</p>
    </div>

    <div class="row mb-5">
        <div class="col-md-4">
            <div class="card feature-card shadow-sm h-100 p-3">
                <h5>Layer 2 Discovery</h5>
                <p class="small text-muted">Unlike Pings (ICMP), ARP operates at the Data Link layer. It can discover devices even if they have a firewall set to "Stealth Mode" or ignore pings.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card feature-card shadow-sm h-100 p-3 border-primary">
                <h5>Vendor OUI Lookup</h5>
                <p class="small text-muted">Every MAC address contains a 3-byte prefix (OUI). This dashboard uses arp-scan to map these IDs to manufacturers like Cisco, Dell, or Apple.</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card feature-card shadow-sm h-100 p-3">
                <h5>Identity Verification</h5>
                <p class="small text-muted">By cross-referencing MAC addresses with our <code>trusted_list.txt</code>, we detect unauthorized hardware on the wire.</p>
            </div>
        </div>
    </div>

    <div class="card shadow mb-5">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <span>Live ARP Table Probe</span>
            <button id="scanBtn" class="btn btn-primary btn-sm" onclick="startScan()">Execute arp-scan -l</button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>MAC Address (Hardware ID)</th>
                            <th>Vendor Identity</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="deviceTable">
                        <tr><td colspan="4" class="text-center text-muted">No scan data. Click "Execute" to begin.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="logic-box shadow-sm border">
                <h4>How this Tool Works</h4>
                <hr>
                <ol>
                    <li><strong>Packet Injection:</strong> The script runs <code>sudo arp-scan -l</code>, which generates ARP requests for the local subnet.</li>
                    <li><strong>Hardware Response:</strong> Devices on the network respond with their MAC addresses.</li>
                    <li><strong>Database Comparison:</strong> The Python backend compares found IPs and MACs against <code>trusted_list.txt</code>.</li>
                    <li><strong>Classification:</strong> Devices are marked <strong>Safe</strong> if they match the list, otherwise <strong>Not Safe</strong>.</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<script>
    async function startScan() {
        const btn = document.getElementById('scanBtn');
        const tableBody = document.getElementById('deviceTable');
        
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Scanning...';
        tableBody.innerHTML = "<tr><td colspan='4' class='text-center'>Probing ARP table and mapping vendors...</td></tr>";

        try {
            const response = await fetch('/scan');
            const data = await response.json();

            tableBody.innerHTML = "";
            data.forEach(device => {
                const isSafe = device.status === 'Safe';
                const badgeClass = isSafe ? 'bg-success' : 'bg-danger';
                
                tableBody.innerHTML += `
                    <tr class="${isSafe ? '' : 'table-warning'}">
                        <td><strong>${device.ip}</strong></td>
                        <td><code>${device.mac}</code></td>
                        <td>${device.vendor}</td>
                        <td><span class="badge ${badgeClass}">${device.status}</span></td>
                    </tr>`;
            });
        } catch (err) {
            tableBody.innerHTML = `<tr><td colspan='4' class='text-center text-danger'>Scan Error: ${err}</td></tr>`;
        }

        btn.disabled = false;
        btn.innerText = "Execute arp-scan -l";
    }
</script>

</body>
</html>